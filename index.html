<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Currency Converter</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#3b82f6',
                        accent: '#60a5fa',
                        neutral: '#f1f5f9',
                        'neutral-dark': '#334155'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .transition-all {
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 300ms;
            }
            .currency-input {
                @apply bg-white border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent;
            }
            .currency-select {
                @apply bg-white border border-gray-300 rounded-md px-4 py-2 appearance-none bg-no-repeat bg-right focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent;
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
                background-position: right 0.5rem center;
                background-size: 1.5em 1.5em;
            }
            .btn {
                @apply px-6 py-2 rounded-md font-medium transition-all focus:outline-none focus:ring-2 focus:ring-offset-2;
            }
            .btn-primary {
                @apply bg-primary text-white hover:bg-primary/90 focus:ring-primary/50;
            }
            .btn-secondary {
                @apply bg-secondary text-white hover:bg-secondary/90 focus:ring-secondary/50;
            }
            .card {
                @apply bg-white rounded-xl shadow-card p-6 transition-all hover:shadow-card-hover;
            }
            .alert {
                @apply p-4 rounded-md mb-4 text-sm font-medium;
            }
            .alert-success {
                @apply bg-green-100 text-green-800;
            }
            .alert-error {
                @apply bg-red-100 text-red-800;
            }
            .loading-spinner {
                @apply w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 标题区域 -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-primary mb-2">Currency Converter</h1>
            <p class="text-neutral-dark">Simple and accurate currency conversion</p>
        </header>

        <!-- 主要内容区域 -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 货币转换卡片 -->
            <div class="card lg:col-span-2">
                <h2 class="text-xl font-semibold text-primary mb-4">Convert Currency</h2>
                
                <!-- 错误消息区域 -->
                <div id="error-message" class="alert alert-error hidden"></div>
                
                <!-- 转换表单 -->
                <form id="conversion-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- 源货币 -->
                        <div>
                            <label for="source-currency" class="block text-sm font-medium text-gray-700 mb-1">From</label>
                            <div class="relative">
                                <select id="source-currency" name="source-currency" class="currency-select w-full">
                                    <!-- 货币选项将通过JavaScript动态添加 -->
                                </select>
                            </div>
                        </div>
                        
                        <!-- 目标货币 -->
                        <div>
                            <label for="target-currency" class="block text-sm font-medium text-gray-700 mb-1">To</label>
                            <div class="relative">
                                <select id="target-currency" name="target-currency" class="currency-select w-full">
                                    <!-- 货币选项将通过JavaScript动态添加 -->
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- 源金额 -->
                        <div>
                            <label for="source-amount" class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
                            <input type="number" id="source-amount" name="source-amount" step="0.01" min="0" value="1" 
                                class="currency-input w-full">
                        </div>
                        
                        <!-- 目标金额 -->
                        <div>
                            <label for="target-amount" class="block text-sm font-medium text-gray-700 mb-1">Result</label>
                            <div class="relative">
                                <input type="text" id="target-amount" name="target-amount" readonly 
                                    class="currency-input w-full bg-gray-50 cursor-not-allowed">
                                <div id="loading" class="absolute right-3 top-2.5 hidden">
                                    <div class="loading-spinner"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 转换按钮 -->
                    <div class="flex justify-between items-center">
                        <button type="button" id="swap-currencies" class="btn btn-secondary flex items-center">
                            <i class="fa fa-exchange mr-2"></i> Swap Currencies
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fa fa-refresh mr-2"></i> Convert
                        </button>
                    </div>
                </form>
                
                <!-- 汇率信息 -->
                <div id="exchange-rate-info" class="mt-4 p-3 bg-blue-50 rounded-md text-sm">
                    <p>1 <span id="rate-source-currency">USD</span> = <span id="exchange-rate">0.00</span> <span id="rate-target-currency">EUR</span></p>
                    <p class="text-xs text-gray-500 mt-1">Last updated: <span id="last-updated">Loading...</span></p>
                </div>
            </div>
            
            <!-- 历史趋势卡片 -->
            <div class="card">
                <h2 class="text-xl font-semibold text-primary mb-4">Historical Trend</h2>
                <div id="chart-container" class="h-64">
                    <canvas id="trend-chart"></canvas>
                </div>
                <div class="mt-4 text-center text-sm text-gray-500">
                    <p>7-day exchange rate trend</p>
                </div>
            </div>
        </main>
        
        <!-- 页脚 -->
        <footer class="mt-8 text-center text-sm text-gray-500">
            <p>Powered by <a href="https://www.exchangerate-api.com" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">ExchangeRate-API</a></p>
            <p class="mt-1">© 2025 Simple Currency Converter</p>
        </footer>
    </div>

    <script>
        // 常见货币列表
        const currencies = [
            { code: 'USD', name: 'US Dollar', symbol: '$' },
            { code: 'EUR', name: 'Euro', symbol: '€' },
            { code: 'GBP', name: 'British Pound', symbol: '£' },
            { code: 'JPY', name: 'Japanese Yen', symbol: '¥' },
            { code: 'CAD', name: 'Canadian Dollar', symbol: 'C$' },
            { code: 'AUD', name: 'Australian Dollar', symbol: 'A$' },
            { code: 'CHF', name: 'Swiss Franc', symbol: 'Fr' },
            { code: 'CNY', name: 'Chinese Yuan', symbol: '¥' },
            { code: 'SEK', name: 'Swedish Krona', symbol: 'kr' },
            { code: 'NZD', name: 'New Zealand Dollar', symbol: 'NZ$' },
            { code: 'MXN', name: 'Mexican Peso', symbol: '$' },
            { code: 'SGD', name: 'Singapore Dollar', symbol: 'S$' },
            { code: 'HKD', name: 'Hong Kong Dollar', symbol: 'HK$' },
            { code: 'NOK', name: 'Norwegian Krone', symbol: 'kr' },
            { code: 'KRW', name: 'South Korean Won', symbol: '₩' },
            { code: 'TRY', name: 'Turkish Lira', symbol: '₺' },
            { code: 'INR', name: 'Indian Rupee', symbol: '₹' },
            { code: 'BRL', name: 'Brazilian Real', symbol: 'R$' },
            { code: 'ZAR', name: 'South African Rand', symbol: 'R' },
            { code: 'PHP', name: 'Philippine Peso', symbol: '₱' }
        ];

        // DOM元素
        const sourceCurrencySelect = document.getElementById('source-currency');
        const targetCurrencySelect = document.getElementById('target-currency');
        const sourceAmountInput = document.getElementById('source-amount');
        const targetAmountInput = document.getElementById('target-amount');
        const conversionForm = document.getElementById('conversion-form');
        const swapCurrenciesBtn = document.getElementById('swap-currencies');
        const errorMessageDiv = document.getElementById('error-message');
        const loadingDiv = document.getElementById('loading');
        const exchangeRateInfoDiv = document.getElementById('exchange-rate-info');
        const rateSourceCurrencySpan = document.getElementById('rate-source-currency');
        const rateTargetCurrencySpan = document.getElementById('rate-target-currency');
        const exchangeRateSpan = document.getElementById('exchange-rate');
        const lastUpdatedSpan = document.getElementById('last-updated');
        const trendChartCanvas = document.getElementById('trend-chart');

        // 填充货币选择器
        function populateCurrencySelectors() {
            currencies.forEach(currency => {
                const sourceOption = document.createElement('option');
                sourceOption.value = currency.code;
                sourceOption.textContent = `${currency.code} - ${currency.name} (${currency.symbol})`;
                sourceCurrencySelect.appendChild(sourceOption);

                const targetOption = document.createElement('option');
                targetOption.value = currency.code;
                targetOption.textContent = `${currency.code} - ${currency.name} (${currency.symbol})`;
                targetCurrencySelect.appendChild(targetOption);
            });

            // 设置默认值
            sourceCurrencySelect.value = 'USD';
            targetCurrencySelect.value = 'EUR';
        }

        // 获取汇率数据
        async function getExchangeRate(sourceCurrency, targetCurrency) {
            try {
                // 使用ExchangeRate-API的公开端点
                const response = await fetch(`https://open.er-api.com/v6/latest/${sourceCurrency}`);
                
                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (!data.rates || !data.rates[targetCurrency]) {
                    throw new Error(`No exchange rate data available for ${targetCurrency}`);
                }
                
                return {
                    rate: data.rates[targetCurrency],
                    date: new Date(data.time_last_update_unix * 1000)
                };
            } catch (error) {
                console.error('Error fetching exchange rate:', error);
                throw error;
            }
        }

        // 转换货币
        async function convertCurrency() {
            const sourceCurrency = sourceCurrencySelect.value;
            const targetCurrency = targetCurrencySelect.value;
            const sourceAmount = parseFloat(sourceAmountInput.value);
            
            // 验证输入
            if (isNaN(sourceAmount) || sourceAmount < 0) {
                showError('Please enter a valid positive number');
                return;
            }
            
            if (sourceAmount === 0) {
                showError('Please enter an amount greater than zero');
                return;
            }
            
            try {
                // 显示加载状态
                showLoading(true);
                hideError();
                
                // 获取汇率
                const { rate, date } = await getExchangeRate(sourceCurrency, targetCurrency);
                
                // 计算目标金额
                const targetAmount = sourceAmount * rate;
                
                // 更新UI
                targetAmountInput.value = targetAmount.toFixed(2);
                
                // 更新汇率信息
                rateSourceCurrencySpan.textContent = sourceCurrency;
                rateTargetCurrencySpan.textContent = targetCurrency;
                exchangeRateSpan.textContent = rate.toFixed(6);
                lastUpdatedSpan.textContent = formatDate(date);
                
                // 隐藏加载状态
                showLoading(false);
                
                // 更新历史趋势图
                updateTrendChart(sourceCurrency, targetCurrency);
                
                return targetAmount;
            } catch (error) {
                console.error('Error fetching exchange rate:', error);
                
                // 提供更友好的错误消息
                let errorMessage = 'Failed to fetch exchange rates. Please try again later.';
                
                if (error.message.includes('429')) {
                    errorMessage = 'Too many requests. Please try again after 20 minutes.';
                } else if (error.message.includes('No exchange rate data')) {
                    errorMessage = 'No exchange rate data available for the selected currency.';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'Network error. Please check your internet connection and try again.';
                }
                
                showError(errorMessage);
                showLoading(false);
                return null;
            }
        }

        // 交换货币
        function swapCurrencies() {
            const sourceCurrency = sourceCurrencySelect.value;
            const targetCurrency = targetCurrencySelect.value;
            
            sourceCurrencySelect.value = targetCurrency;
            targetCurrencySelect.value = sourceCurrency;
            
            // 如果已经有转换结果，交换金额和汇率
            if (targetAmountInput.value && !isNaN(parseFloat(exchangeRateSpan.textContent))) {
                const sourceAmount = parseFloat(sourceAmountInput.value);
                const targetAmount = parseFloat(targetAmountInput.value);
                
                sourceAmountInput.value = targetAmount;
                targetAmountInput.value = sourceAmount;
                
                // 更新汇率信息
                const tempRate = parseFloat(exchangeRateSpan.textContent);
                if (!isNaN(tempRate) && tempRate !== 0) {
                    exchangeRateSpan.textContent = (1 / tempRate).toFixed(6);
                }
                
                const tempSource = rateSourceCurrencySpan.textContent;
                rateSourceCurrencySpan.textContent = rateTargetCurrencySpan.textContent;
                rateTargetCurrencySpan.textContent = tempSource;
            } else {
                // 如果还没有转换结果，直接进行转换
                convertCurrency();
            }
            
            // 更新历史趋势图
            updateTrendChart(sourceCurrencySelect.value, targetCurrencySelect.value);
        }

        // 显示/隐藏加载状态
        function showLoading(isLoading) {
            if (isLoading) {
                loadingDiv.classList.remove('hidden');
                targetAmountInput.disabled = true;
            } else {
                loadingDiv.classList.add('hidden');
                targetAmountInput.disabled = false;
            }
        }

        // 显示错误消息
        function showError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('hidden');
        }

        // 隐藏错误消息
        function hideError() {
            errorMessageDiv.classList.add('hidden');
        }

        // 格式化日期
        function formatDate(date) {
            return new Intl.DateTimeFormat('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZoneName: 'short'
            }).format(date);
        }

        // 获取历史汇率数据（模拟）
        function getHistoricalRates(sourceCurrency, targetCurrency) {
            // 由于公开API不提供历史数据，我们模拟一些数据
            const today = new Date();
            const labels = [];
            const data = [];
            
            // 生成过去7天的数据
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                
                labels.push(new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric' }).format(date));
            }
            
            // 生成一个基于当前汇率的随机值序列，模拟汇率波动
            const baseRate = parseFloat(exchangeRateSpan.textContent) || 1;
            
            // 如果没有有效的基础汇率，返回空数据
            if (isNaN(baseRate)) {
                return { labels, data: Array(7).fill(null) };
            }
            
            // 生成一个有趋势的随机序列
            let currentRate = baseRate * (0.95 + Math.random() * 0.1); // 初始值在 0.95-1.05 倍基础汇率之间
            
            for (let i = 0; i < 7; i++) {
                // 每天的波动范围在 -2% 到 +2% 之间
                const dailyChange = currentRate * (Math.random() * 0.04 - 0.02);
                currentRate = Math.max(0.0001, currentRate + dailyChange); // 确保汇率不为负
                data.push(parseFloat(currentRate.toFixed(6)));
            }
            
            return { labels, data };
        }

        // 更新趋势图
        function updateTrendChart(sourceCurrency, targetCurrency) {
            try {
                const { labels, data } = getHistoricalRates(sourceCurrency, targetCurrency);
                
                // 如果图表已存在，销毁它
                if (window.trendChart) {
                    window.trendChart.destroy();
                }
                
                // 创建新图表
                window.trendChart = new Chart(trendChartCanvas, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `${sourceCurrency}/${targetCurrency}`,
                            data: data,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#3b82f6',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        return `Rate: ${context.parsed.y}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                beginAtZero: false,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toFixed(4);
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error updating trend chart:', error);
                // 可以在这里添加用户友好的错误提示
            }
        }

        // 初始化
        function init() {
            // 填充货币选择器
            populateCurrencySelectors();
            
            // 初始转换
            convertCurrency();
            
            // 表单提交事件
            conversionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                convertCurrency();
            });
            
            // 交换货币按钮点击事件
            swapCurrenciesBtn.addEventListener('click', swapCurrencies);
            
            // 源金额输入事件
            sourceAmountInput.addEventListener('input', function() {
                // 如果输入有效且不是初始值，自动转换
                if (this.value && this.value !== '0' && this.value !== '0.00') {
                    convertCurrency();
                }
            });
            
            // 货币选择事件
            sourceCurrencySelect.addEventListener('change', convertCurrency);
            targetCurrencySelect.addEventListener('change', convertCurrency);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
